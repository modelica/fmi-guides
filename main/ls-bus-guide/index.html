<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>FMI LS BUS Implementers' Guide</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:30em;padding-right:0}
#toc.toc2{width:30em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

/* customizations */

body{
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
}

.toc-hidden {
  padding-left: 0 !important;
}

.imageblock {
  text-align: center;
}

.imageblock img {
  display: block;
  margin: auto;
}

.imageblock .title {
  display: inline-block;
  margin: auto;
}

.vertical-text {
	transform: rotate(-90deg) translate(-11em, 0);
	transform-origin: left top 0;
  float: left;
  display: inline-block;
  white-space: nowrap;
  width: 1em;
  height: 11em;
}

/* no alternating row colors */
table tr.even,table tr.alt,table tr:nth-of-type(even) {
  background:none
}

/* use parent text color for captions */
.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
  color: inherit;
}

a {
  text-decoration: none;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<script>
// hide / show the Table of Contents (TOC)
function toggleTOC() {
  var toc = document.getElementById("toc");
  var body = document.getElementsByTagName("body")[0];

  if (toc.style.display === "none") {
      toc.style.display = "block";
      body.classList.remove("toc-hidden");
  } else {
      toc.style.display = "none";
      body.classList.add("toc-hidden");
  }
}

// toggle the TOC when "t" key is pressed
document.addEventListener('keydown', (event) => {
  if (event.key == 't') {
    toggleTOC();
  }
});
</script>

<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
.tocify-header {
    font-style: italic;
}

.tocify-subheader {
    font-style: normal;
    font-size: 90%;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    color: #7a2518;
    background-color: rgba(0, 0, 0, 0.1);
}

.tocify-focus > a {
    color: #7a2518;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            // don't hide the sections in the TOC
            showAndHide: false,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3" : "h2,h3,h4",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>

<img style="display: block; margin: 2em auto; width: 30em;" src="images/FMI_logo_horizontal.svg" alt="FMI logo">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>FMI LS BUS Implementers' Guide</h1>
<div class="details">
<span id="revnumber">version main-ed7864a545b0c66a447d2e028a2595d7dcc13c85,</span>
<span id="revdate">2023-12-06</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_common">2. Common</a></li>
<li><a href="#_physical_signal_abstraction_high_cut">3. Physical Signal Abstraction ("high cut")</a></li>
<li><a href="#_network_abstraction_low_cut">4. Network Abstraction ("low cut")</a>
<ul class="sectlevel2">
<li><a href="#_can_can_fd_can_xl">4.1. CAN, CAN FD, CAN XL</a>
<ul class="sectlevel3">
<li><a href="#low-cut-can-getting-started-with-can">4.1.1. Getting Started with CAN, CAN FD and CAN XL</a>
<ul class="sectlevel4">
<li><a href="#low-cut-can-getting-started-provided-header-files">4.1.1.1. Provided Header Files</a></li>
<li><a href="#_general_aspects">4.1.1.2. General Aspects</a></li>
<li><a href="#_buffer_handling">4.1.1.3. Buffer Handling</a></li>
<li><a href="#_creating_bus_operations">4.1.1.4. Creating Bus Operations</a></li>
<li><a href="#_transmitting_bus_operations">4.1.1.5. Transmitting Bus Operations</a></li>
<li><a href="#_receiving_bus_operations">4.1.1.6. Receiving Bus Operations</a></li>
<li><a href="#_processing_of_bus_operations">4.1.1.7. Processing of Bus Operations</a></li>
</ul>
</li>
<li><a href="#low-cut-can-demos">4.1.2. Demos</a></li>
<li><a href="#low-cut-can-sequence-diagrams">4.1.3. Sequence Diagrams</a>
<ul class="sectlevel4">
<li><a href="#low-cut-can-example-transmission">4.1.3.1. Transmission</a></li>
<li><a href="#low-cut-can-example-can-arbitration-without-buffering">4.1.3.2. CAN Arbitration without Buffering</a></li>
<li><a href="#low-cut-can-example-can-arbitration-with-buffering">4.1.3.3. CAN Arbitration with Buffering</a></li>
</ul>
</li>
<li><a href="#low-cut-can-realization-of-can-error-handling">4.1.4. Realization of CAN Error Handling</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The FMI LS Bus Implementers' Guide is a free resource intended to give non-normative recommendations and guidance to implementers of the Functional Mock-up Interface layered standard Network Communication (FMI-LS-BUS).
This document is continually revised based on implementer and user feedback and input.
All of the content is to be considered non-normative and shall not be considered to supplant any normative statement in the FMI 3.0 standard, the FMI-LS-BUS layered standard, or any other standard or layered standard.
<a href="https://github.com/modelica/fmi-guides/releases">Releases</a> and <a href="https://github.com/modelica/fmi-guides/issues">issues</a> can be found on <a href="https://github.com/modelica/fmi-guides">github.com/modelica/fmi-guides</a>.</p>
</div>
<div class="paragraph">
<p><br>
</p>
</div>
<div class="paragraph">
<p>Copyright &#169; 2021-2023 The Modelica Association Project FMI.</p>
</div>
<div class="paragraph">
<p>This document is licensed under the Attribution-ShareAlike 4.0 International license.
The code is released under the 2-Clause BSD License.
The licenses text can be found in the <a href="https://raw.githubusercontent.com/modelica/fmi-guides/main/LICENSE.txt">LICENSE.txt</a> file that accompanies this distribution.</p>
</div>
<div class="paragraph">
<p>Attention is drawn to the possibility that some of the elements of this document may be the subject of patent rights.
Modelica Association shall not be held responsible for identifying such patent rights.</p>
</div>
<div class="paragraph">
<p></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document provides best practice recommendations to implementers of <a href="https://modelica.github.io/fmi-ls-bus/main/">FMI Layered Standard for Network Communication</a>.
The overarching goal of the recommendations is to aid interoperability of implementations and ensure good ease-of-use for the user in employing FMI.</p>
</div>
<div class="paragraph">
<p>This document is intended for simulation tool vendors planning to support FMI Layered Standard for Network Communication in their products, either for creating or simulating such FMUs, or both.
It assumes a technical audience familiar with the specification documents and tries to give further information and hints in areas where either the relevant specification documents have been found sometimes to be less clear than expected or where user expectations are relevant to implementation choices.
It also considers errors and bugs encountered in the practical use of existing FMI implementations and guides to avoid common pitfalls.</p>
</div>
<div class="paragraph">
<p>This document will be maintained and expanded over time as new issues or needs for clarification appear.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common">2. Common</h2>
<div class="sectionbody">
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_physical_signal_abstraction_high_cut">3. Physical Signal Abstraction ("high cut")</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter contains details on common topics of the physical signal abstraction layer.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_network_abstraction_low_cut">4. Network Abstraction ("low cut")</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter contains details on common topics of the network abstraction layer.</p>
</div>
<div class="sect2">
<h3 id="_can_can_fd_can_xl">4.1. CAN, CAN FD, CAN XL</h3>
<div class="paragraph">
<p>This chapter contains details on CAN, CAN FD, CAN XL specific topics.</p>
</div>
<div class="sect3">
<h4 id="low-cut-can-getting-started-with-can">4.1.1. Getting Started with CAN, CAN FD and CAN XL</h4>
<div class="paragraph">
<p>This section shows the exemplary implementation in conjunction with the provided header files of the fmi-ls-bus layered standard.</p>
</div>
<div class="sect4">
<h5 id="low-cut-can-getting-started-provided-header-files">4.1.1.1. Provided Header Files</h5>
<div class="paragraph">
<p>Besides the textual specification for FMUs with bus support, the Layered Standard for Network Communication also provides a C API to make the creation of FMUs with bus support as easy and generalized as possible.
The standard differentiates between two groups of files within the C API: Mandatory and optional files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/modelica/fmi-ls-bus/blob/main/headers/fmi3LsBus.h">fmi3LsBus.h</a> provides general macros, types and structures of common Bus Operations.
This header file applies to all supported bus types of the layered standard.
The usage of this file is mandatory.</p>
</li>
<li>
<p><a href="https://github.com/modelica/fmi-ls-bus/blob/main/headers/fmi3LsBusCan.h">fmi3LsBusCan.h</a> provides macros, types and structures of Bus Operations explicit for CAN, CAN FD and CAN XL.
Primarily, structures are included here that allow the Bus Operations specified by the layered standard to be easily created and used.
The usage of this file is mandatory.</p>
</li>
<li>
<p><a href="https://github.com/modelica/fmi-ls-bus/blob/main/headers/fmi3LsBusUtil.h">fmi3LsBusUtil.h</a> provides common utility macros and structures for all supported bus types.
The usage of this file is optional.</p>
</li>
<li>
<p><a href="https://github.com/modelica/fmi-ls-bus/blob/main/headers/fmi3LsBusUtilCan.h">fmi3LsBusUtilCan.h</a> provides CAN, CAN FD and CAN XL explicit utility macros.
The usage of this file is optional.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_general_aspects">4.1.1.2. General Aspects</h5>
<div class="paragraph">
<p>Bus Operations represent protocol units to be transmitted in the environment of the layered standard based on the <a href="https://modelica.github.io/fmi-ls-bus/main/#low-cut-layered-standard-bus-protocol">Layered Standard Bus Protocol</a>.
All FMI variables required for the exchange are grouped by a defined <a href="https://modelica.github.io/fmi-ls-bus/main/#low-cut-bus-terminal">Bus Terminal</a>.
Bus Operations are created and processed within an FMU.
This can be done either in <code>Step Mode</code> or in <code>Event Mode</code>.
For a transfer, all Bus Operations are serialized together in a <code>fmi3Binary</code> <a href="https://modelica.github.io/fmi-ls-bus/main/#low-cut-tx-rx-data-variables">variable</a>.
This serialization can be done using the provided <a href="#low-cut-can-getting-started-provided-header-files">header files</a> or using a custom approach.
After the contents of the binary variables have been transferred to another FMU via an FMU importer, they are deserialized again and then processed inside the receiver.</p>
</div>
<div id="figure-general-aspects-overview" class="imageblock text-center">
<div class="content">
<img src="images/create_process_bus_operations.svg" alt="create process bus operations" width="60%">
</div>
<div class="title">Figure 1. Create, process and transfer Bus Operations.</div>
</div>
<div class="paragraph">
<p>The point in time where Bus Operations are transferred between different FMUs is defined by the usage of <code>fmi3Clock</code> variables.
For this reason, the exchange of Bus Operations is always carried out within the <code>Event Mode</code>.
Details about possible entry points regarding the FMI interface will be provided later in this section.
However, it is important to know that due to the resulting decoupling between the generation, processing and transfer of Bus Operations, the need for buffer semantics arises.
This semantics is reflected directly in the structure and handling of the <a href="#low-cut-can-getting-started-provided-header-files">header files</a> provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="_buffer_handling">4.1.1.3. Buffer Handling</h5>
<div class="paragraph">
<p>For exchanging Bus Operations between FMUs, variables of type <code>fmi3Binary</code> type are used.
For this reason, appropriate variables must first be set up within the implementation that represent the content for this exchange.
The buffer variable can be easily initialized in the form of an <code>fmi3UInt8</code> array of any size.
It should be noted that the entire buffer size must of course provide enough space for all created Bus Operations during a <code>fmi3DoStep</code>.
To simplify our example, the buffers are declared as global variables within the FMU.</p>
</div>
<div class="paragraph">
<p>Since describing and reading Bus Operations from a simple array can be quite complicated, the common utility headers provide an <code>fmi3LsBusUtilBufferInfo</code> entity.
This abstraction represents a kind of view of the underlying buffer array and allows simplified access using additionally provided functionality.</p>
</div>
<div class="paragraph">
<p>The following program code shows the definition and initialization of a buffer for transmitting (Tx) and receiving (Rx) Bus Operations in the form of an array.
In addition, an <code>fmi3LsBusUtilBufferInfo</code> is created for both buffer variables.
Using <code>FMI3_LS_BUS_BUFFER_INFO_INIT</code>, the underlying buffer is coupled to the respective <code>fmi3LsBusUtilBufferInfo</code> instance.</p>
</div>
<div class="listingblock">
<div class="title">Setting up buffering and fmi3LsBusUtilBufferInfo instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include "fmi3PlatformTypes.h"
#include "fmi3LsBusUtil.h"      <i class="conum" data-value="1"></i><b>(1)</b>

fmi3UInt8 TxBufferCan[2048];    <i class="conum" data-value="2"></i><b>(2)</b>
fmi3UInt8 RxBufferCan[2048];
fmi3LsBusUtilBufferInfo TxBufferInfoCan;    <i class="conum" data-value="3"></i><b>(3)</b>
fmi3LsBusUtilBufferInfo RxBufferInfoCan;

fmi3Instance fmi3InstantiateCoSimulation(...) {
    FMI3_LS_BUS_BUFFER_INFO_INIT(&amp;TxBufferInfoCan, TxBufferCan, sizeof(TxBufferCan));    <i class="conum" data-value="4"></i><b>(4)</b>
    FMI3_LS_BUS_BUFFER_INFO_INIT(&amp;RxBufferInfoCan, RxBufferCan, sizeof(RxBufferCan));
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Necessary include of the fmi3LsBusUtil.h header file.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Definition and initialization of a <code>fmi3Binary</code> buffer variable.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Definition of <code>fmi3LsBusUtilBufferInfo</code> variable instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Coupling of a Buffer and a <code>fmi3LsBusUtilBufferInfo</code> variable.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The buffer is always treated by the provided header functionalities using FIFO (First In - First Out) semantics.
The further usage of the <code>fmi3LsBusUtilBufferInfo</code> variable is discussed later.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Summary</div>
<div class="ulist">
<ul>
<li>
<p>The transfer of Bus Operations must typically be decoupled from creation and processing</p>
</li>
<li>
<p>The API provides macros for buffering of Bus Operations in a FIFO manner</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_creating_bus_operations">4.1.1.4. Creating Bus Operations</h5>
<div class="paragraph">
<p>The header file <a href="https://github.com/modelica/fmi-guides/blob/main/ls-bus-guide/headers/fmi3LsBusUtilCan.h">fmi3LsBusUtilCan.h</a> offers macros for all Bus Operations specified by the layered standard, which minimize the effort required to create and serialize such an operation.
The macros are always provided according to the following syntax: <code>FMI3_LS_BUS_&lt;BusType&gt;_CREATE_OP_&lt;OperationName&gt;</code>.
Following these rule, the macro for creating a CAN Transmit operation is <code>FMI3_LS_BUS_CAN_CREATE_OP_CAN_TRANSMIT</code>.
A macro for creating an operation also assigns it to a buffer described by an <code>fmi3LsBusUtilBufferInfo</code> instance.</p>
</div>
<div class="paragraph">
<p>The following program code shows how to first define the payload and the ID that should be used in the CAN Transmit operation.
Afterwards, the <code>fmi3LsBusUtilBufferInfo</code> is reset by using <code>FMI3_LS_BUS_BUFFER_INFO_RESET</code>.
<code>FMI3_LS_BUS_BUFFER_INFO_RESET</code> sets the internal position of the <code>fmi3LsBusUtilBufferInfo</code> instance to zero, so that it is essentially emptied and written from the beginning.
This is necessary to ensure that Bus Operations that have already been transmitted are not transmitted again.
<code>FMI3_LS_BUS_CAN_CREATE_OP_CAN_TRANSMIT</code> now creates a new CAN Transmit operation with the associated parameters such as CAN ID and payload and adds them directly to the <code>fmi3LsBusUtilBufferInfo</code> instance.
Querying the status of a <code>fmi3LsBusUtilBufferInfo</code> instance allows you to check whether there is still enough space in the underlying buffer.
In the last step, <code>FMI3_LS_BUS_BUFFER_LENGTH</code> is used to check whether there are Bus Operations in the respective <code>fmi3LsBusUtilBufferInfo</code> variable that should be transmitted in <code>Event Mode</code>.</p>
</div>
<div class="listingblock">
<div class="title">Creation of a CAN Transmit operation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">#include "Fmi3LsBusUtilCan.h"

fmi3Status fmi3DoStep(..., eventHandlingNeeded, ...) {
    fmi3UInt8 msg[] = "Hey guys";   <i class="conum" data-value="1"></i><b>(1)</b>
    fmi3LsBusCanId msgId = 42;      <i class="conum" data-value="2"></i><b>(2)</b>

    /* Reset read/write positions of the BufferInfo variable */
    FMI3_LS_BUS_BUFFER_INFO_RESET(&amp;TxBufferInfoCan);    <i class="conum" data-value="3"></i><b>(3)</b>

    /* Create a CAN Transmit operation to be send */
    FMI3_LS_BUS_CAN_CREATE_OP_CAN_TRANSMIT(&amp;TxBufferInfoCan, msgId, &lt;options&gt;, sizeof(msg), msg);    <i class="conum" data-value="4"></i><b>(4)</b>

    if(!TxBufferInfoCan.status){   <i class="conum" data-value="5"></i><b>(5)</b>
        /* Error: No free buffer space available */
    }

    ...

    if(FMI3_LS_BUS_BUFFER_LENGTH(&amp;TxBufferInfoCan) &gt; 0){
        *eventHandlingNeeded = fmi3True;    <i class="conum" data-value="6"></i><b>(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creation of CAN frame payload.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Definition of CAN ID of the specified frame.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Resetting of <code>fmi3LsBusUtilBufferInfo</code> variable instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creation of a CAN Transmit operation and adding it to the specified <code>fmi3LsBusUtilBufferInfo</code> variable.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify that free buffer space is available.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Signal that <code>Event Mode</code> is needed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>According to the same principles, any specified operation can be created using the corresponding macro.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Summary</div>
<div class="ulist">
<ul>
<li>
<p>Bus Operations can be created by using the provided FMI3_LS_BUS_&lt;BusType&gt;_CREATE_OP_&lt;OperationName&gt; macros</p>
</li>
<li>
<p>The CREATE_OP macros are creating a Bus Operation and updating the given buffer in a single step</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_transmitting_bus_operations">4.1.1.5. Transmitting Bus Operations</h5>
<div class="paragraph">
<p>Within the layered standard, the <a href="https://modelica.github.io/fmi-ls-bus/main/#low-cut-variables">connection</a> between the data to be exchanged (<code>TX_Data</code> and <code>Rx_Data</code>) and the time of exchange
(<code>Tx_Clock</code> and <code>Rx_Clock</code>) has been well defined.
The <a href="https://modelica.github.io/fmi-ls-bus/main/#low-cut-tx-triggered-clock-variables">simplest case</a> represents a <code>triggered</code> <code>Tx_Clock</code> that basically allows to signal events when returning from <code>fmi3DoStep</code>.</p>
</div>
<div class="paragraph">
<p>The program code below schematically illustrates an implementation.
<code>fmi3GetClock</code> is called by the FMU importer in <code>Event Mode</code> after <code>fmi3DoStep</code> has completed or ended prematurely.
Within <code>fmi3GetClock</code>, <code>TX_CLOCK_REFERENCE</code> represents the <code>valueReference</code> of the respective <code>Tx_Clock</code>.
The usage of the macro <code>FMI3_LS_BUS_BUFFER_IS_EMPTY</code> indicates whether there is data to be transferred in the respective buffer.
If this is the case, the corresponding <code>Tx_Clock</code> will tick.</p>
</div>
<div class="paragraph">
<p>The content of the <code>fmi3LsBusUtilBufferInfo</code> instance is provided to the FMU importer via <code>fmi3GetBinary</code>.
The value can be easily passed on to the FMI interface by using the <code>FMI3_LS_BUS_BUFFER_START</code> macro.
<code>FMI3_LS_BUS_BUFFER_LENGTH</code> can also be used to set the size of the <code>fmi3Binary</code> variable.</p>
</div>
<div class="listingblock">
<div class="title">Transmit Bus Operations via triggered clock</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">fmi3Status fmi3GetClock(fmi3Instance instance,
                         const fmi3ValueReference valueReferences[],
                         size_t nValueReferences,
                         fmi3Clock values[]) {
    ...
    for (size_t i = 0; i &lt; nValueReferences; i++) {
        if (valueReferences[i] == TX_CLOCK_REFERENCE) {
            if(!FMI3_LS_BUS_BUFFER_IS_EMPTY(&amp;TxBufferInfoCan)) {    <i class="conum" data-value="1"></i><b>(1)</b>
                *values[i] = fmi3ClockActive;                       <i class="conum" data-value="2"></i><b>(2)</b>
            }
        }
    }
    ...
}

fmi3Status fmi3GetBinary(fmi3Instance instance,
                          const fmi3ValueReference valueReferences[],
                          size_t nValueReferences,
                          size_t valueSizes[],
                          fmi3Binary values[],
                          size_t nValues) {
    ...
    for (size_t i = 0; i &lt; nValueReferences; i++) {
        if (valueReferences[i] == TX_DATA_REFERENCE) {
            *values[i] = FMI3_LS_BUS_BUFFER_START(&amp;TxBufferInfoCan);        <i class="conum" data-value="3"></i><b>(3)</b>
            *valueSizes[i] = FMI3_LS_BUS_BUFFER_LENGTH(&amp;TxBufferInfoCan);   <i class="conum" data-value="4"></i><b>(4)</b>
        }
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Verify if Bus Operations exist for transfer.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Activate specified <code>Tx_Clock</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get the start memory address of the buffer, by using <code>fmi3LsBusUtilBufferInfo</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get the size of the buffer, by using <code>fmi3LsBusUtilBufferInfo</code> instance.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that, according to the FMI 3.0 standard, <code>fmi3GetClock</code> only returns <code>fmi3ClockActive</code> once per clock activation.</p>
</div>
<div class="paragraph">
<p>It should be clear that, depending on the application, the different FMI clock types each offer advantages and disadvantages. See also the <a href="https://modelica.github.io/fmi-ls-bus/main/#low-cut-selecting-tx-variables">corresponding chapter in the layered standard</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Summary</div>
<div class="ulist">
<ul>
<li>
<p>The LS-BUS C API provides macros to get the START address and LENGTH of the buffer which can be used in the context of <code>fmi3GetClock</code> and <code>fmi3GetBinary</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_receiving_bus_operations">4.1.1.6. Receiving Bus Operations</h5>
<div class="paragraph">
<p>The indication whether new operations are pending within the <code>Rx_Data</code> variable is done via the <code>Rx_Clock</code>.
This clock ticks as soon as new data is available.
The operation-receiving FMU gets the Bus Operations via an <code>fmi3Binary</code> variable.
The contents of this variable may then be copied into a buffer described by an <code>fmi3LsBusUtilBufferInfo</code> instance using <code>FMI3_LS_BUS_BUFFER_WRITE</code>.</p>
</div>
<div class="paragraph">
<p>The code snipped below shows its usage within the <code>fmi3SetClock</code> and <code>fmi3SetBinary</code> functions, which an FMU importer calls when setting the concrete <code>Rx_Data</code> variable.</p>
</div>
<div class="listingblock">
<div class="title">Receiving Bus Operations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">fmi3Clock RxClock;
fmi3UInt8 RxBufferCan[2048];
fmi3LsBusUtilBufferInfo RxBufferInfoCan;

fmi3Status fmi3SetClock(fmi3Instance instance,
                         const fmi3ValueReference valueReference[],
                         size_t nValueReferences,
                         const fmi3clock values[]) {
    ...
    for (size_t i = 0; i &lt; nValueReferences; i++) {
        if (valueReferences[i] == RX_CLOCK_REFERENCE &amp;&amp; values[i] == fmi3ClockActive) { <i class="conum" data-value="1"></i><b>(1)</b>
            /* Set an indicator that clock ticked and new Bus Operations arrived */
            RxClock = values[i]; <i class="conum" data-value="2"></i><b>(2)</b>
        }
    }
    ...
}

fmi3Status fmi3SetBinary(fmi3Instance instance,
                          const fmi3ValueReference valueReferences[],
                          size_t nValueReferences,
                          const size_t valueSize,
                          const fmi3Binary value, ...) {
    ...
    for (size_t i = 0; i &lt; nValueReferences; i++) {
        if (valueReferences[i] == RX_DATA_REFERENCE &amp;&amp; RxClock == fmi3ClockActive) {
            FMI3_LS_BUS_BUFFER_WRITE(&amp;RxBufferInfoCan, value[i], valueSize[i]); <i class="conum" data-value="3"></i><b>(3)</b>
        }
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Check if <code>Rx_Clock</code> has ticked.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Store the information for global access within other FMI interface functions.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an <code>fmi3LsBusUtilBufferInfo</code> instance based on received Bus Operations.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Summary</div>
<div class="ulist">
<ul>
<li>
<p>The LS-BUS API provides macros to write received binary data into a given buffer</p>
</li>
<li>
<p>The buffer is updated by the <code>FMI3_LS_BUS_BUFFER_WRITE</code> macro</p>
</li>
<li>
<p>The <code>FMI3_LS_BUS_BUFFER_WRITE</code> can be called repeatedly</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_processing_of_bus_operations">4.1.1.7. Processing of Bus Operations</h5>
<div class="paragraph">
<p>The Bus Operations must now be processed on the receiving side.
A suitable place for implementation represents <code>fmi3UpdateDiscreteStates</code>.
In this case, the <code>FMI3_LS_BUS_READ_NEXT_OPERATION</code> macro can be used to successively deserialize all received Bus Operations into the correct operation structure.
After this, they can be further processed.</p>
</div>
<div class="listingblock">
<div class="title">Processing received Bus Operations.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">fmi3Status fmi3UpdateDiscreteStates(...)
{
    fmi3LsBusOperationHeader* hdr;
    ...
    if (fmi3ClockActive == RxClock) {
        /* Processing of received Bus Operations */
        while (FMI3_LS_BUS_READ_NEXT_OPERATION(&amp;RxBufferInfoCan, hdr))    <i class="conum" data-value="1"></i><b>(1)</b>
        {
            switch (hdr-&gt;type)                                            <i class="conum" data-value="2"></i><b>(2)</b>
            {
                case FMI3_LS_BUS_CAN_OP_CAN_TRANSMIT:
                    fmi3LsBusCanOperationCanTransmit *receivedTransmitOp   <i class="conum" data-value="3"></i><b>(3)</b>
                        = (fmi3LsBusCanOperationCanTransmit*) hdr;
            ...
            }
        }

        /* Reset clock */
        RxClock = fmi3ClockInactive;

        /* Reset read/write positions */
        FMI3_LS_BUS_BUFFER_INFO_RESET(&amp;RxBufferInfoCan);
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Read the next operation from the <code>fmi3LsBusUtilBufferInfo</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Decide which kind of operation needs to be handled.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Cast to the specific operation structure.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Summary</div>
<div class="ulist">
<ul>
<li>
<p>Received Bus Operations can be processed by using the <code>FMI3_LS_BUS_READ_NEXT_OPERATION</code> macro</p>
</li>
<li>
<p><code>FMI3_LS_BUS_BUFFER_INFO_RESET</code> allows to reset the <code>fmi3LsBusUtilBufferInfo</code> instance after processing</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="low-cut-can-demos">4.1.2. Demos</h4>
<div class="paragraph">
<p>The following list contains demos, which illustrate both the Bus Simulation as such and Network FMUs of various designs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/modelica/fmi-guides/tree/main/ls-bus-guide/demos/can-bus-simulation">CAN Bus Simulation</a>: Represents an exemplary Bus Simulation FMU for CAN.
This Bus Simulation can be used in combination with the other Network FMUs listed below.</p>
</li>
<li>
<p><a href="https://github.com/modelica/fmi-guides/tree/main/ls-bus-guide/demos/can-node-triggered-output">CAN Triggered Output</a>: This demo Network FMU demonstrates sending and receiving multiple CAN Transmit operations using <code>triggered</code> output clocks.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="low-cut-can-sequence-diagrams">4.1.3. Sequence Diagrams</h4>
<div class="paragraph">
<p>This section contains sample sequences to clarify the facts in the CAN, CAN FD, CAN XL part.</p>
</div>
<div class="sect4">
<h5 id="low-cut-can-example-transmission">4.1.3.1. Transmission</h5>
<div class="paragraph">
<p><a href="#figure-can-transmission-acknowledge">Figure 2</a> illustrates the two possible results of a <code>Transmit</code> operation, whereby the transition from FMU 1 &#8594; FMU 2 represents the successful case and FMU 2 &#8594; FMU 1 represents the unsuccessful case.
For the second transmission, the Bus Simulation injects a transmission error.
In step (1), a <code>Transmit</code> operation is delivered to the Bus Simulation.
In step (2), the <code>Transmit</code> operation is successfully transferred to FMU 2.
In the same step, the Bus Simulation announces the success to FMU 1 via <code>Confirm</code> operation.
In step (3), FMU 2 wants to transmit network data to FMU 1:
A <code>Transmit</code> operation is delivered from FMU 2 to the Bus Simulation.
In step (4), the Bus Simulation intentionally injects a transmission error, which results in a <code>Bus Error</code> operation being sent to both Network FMUs.
The <code>Bus Error</code> operation signals FMU 2 that its transmission attempt was not successful.
Within this <code>Bus Error</code> operation, the <code>Is Sender</code> argument is set to <code>TRUE</code> for FMU 2, because it initiated the failing <code>Transmit</code> operation.
Another <code>Bus Error</code> operation instance is provided by the Bus Simulation to FMU 1.
For FMU 1, the <code>Error Flag</code> argument is set to <code>PRIMARY_ERROR_FLAG</code>, which means that FMU 1 detects the specified transmission error.</p>
</div>
<div id="figure-can-transmission-acknowledge" class="imageblock text-center">
<div class="content">
<img src="images/can_transmission_acknowledge.svg" alt="can transmission acknowledge" width="60%">
</div>
<div class="title">Figure 2. Successful and unsuccessful cases of a CAN transmission.</div>
</div>
<div class="paragraph">
<p>Normally, transmission failures cannot occur during a simulated bus transmission.
For advanced testing scenarios, common bus errors are used to inject transmission errors, e.g., by the Bus Simulation FMU.</p>
</div>
</div>
<div class="sect4">
<h5 id="low-cut-can-example-can-arbitration-without-buffering">4.1.3.2. CAN Arbitration without Buffering</h5>
<div class="paragraph">
<p><a href="#figure-can-arbitration-overview">Figure 3</a> shows the realization of a CAN arbitration by using the <code>Arbitration Lost Behavior</code> option <code>DISCARD_AND_NOTIFY</code> within the <code>Configuration</code> operation.
At the beginning, FMU 1 and FMU 2 each send network data at the same time.
In this situation, an arbitration is necessary to decide which frame should be sent in this case.
Both frames are transferred to the Bus Simulation, where the arbitration is performed.
In the example given, the two frames with CAN ID = 15 and CAN ID = 16 are analyzed and it is decided that CAN ID = 15 wins the arbitration.
The Bus Simulation then calculates the transmission time for the CAN frame with CAN ID = 15.
The next time the FMI <code>Event Mode</code> is called for the Bus Simulation, the corresponding CAN frame is transmitted to FMU 2 and FMU 3.
For CAN ID 16, FMU 2 is informed via an <code>Arbitration Lost</code> operation that this frame could not be sent.
FMU 1 receives a <code>Confirm</code> operation, because the specified frame with CAN ID 15 was successfully transmitted.</p>
</div>
<div id="figure-can-arbitration-overview" class="imageblock text-center">
<div class="content">
<img src="images/can_arbitration_overview.svg" alt="can arbitration overview" width="80%">
</div>
<div class="title">Figure 3. Arbitration of CAN frames within Bus Simulation.</div>
</div>
</div>
<div class="sect4">
<h5 id="low-cut-can-example-can-arbitration-with-buffering">4.1.3.3. CAN Arbitration with Buffering</h5>
<div class="paragraph">
<p><a href="#figure-can-arbitration-overview-with-buffer">Figure 4</a> shows the realization of a CAN arbitration by using the <code>Arbitration Lost Behavior</code> option <code>BUFFER_AND_RETRANSMIT</code> within the <code>Configuration</code> operation.
At the beginning, FMU 1 and FMU 2 each send network data at the same time.
In this situation, an arbitration is necessary to decide which frame should be sent in this case.
Both frames are transferred to the Bus Simulation, where the arbitration is performed.
In the example given, the two frames with CAN ID = 15 and CAN ID = 16 are analyzed and it is decided that CAN ID = 15 wins the arbitration.
The Bus Simulation then calculates the transmission time for the CAN frame with CAN ID = 15.
The next time the FMI <code>Event Mode</code> is called for the Bus Simulation, the corresponding CAN frame is transmitted to FMU 2 and FMU 3.
The <code>Transmit</code> operation of CAN ID 16 is buffered by the Bus Simulation and will be sent within the next time slot.
The Bus Simulation does not return an <code>Arbitration Lost</code> operation to FMU 2.
FMU 1 gets a <code>Confirm</code> operation, because the specified frame with CAN ID 15 was successfully transmitted.</p>
</div>
<div id="figure-can-arbitration-overview-with-buffer" class="imageblock text-center">
<div class="content">
<img src="images/can_arbitration_overview_with_buffer.svg" alt="can arbitration overview with buffer" width="80%">
</div>
<div class="title">Figure 4. Arbitration of CAN frames with buffering within Bus Simulation.</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="low-cut-can-realization-of-can-error-handling">4.1.4. Realization of CAN Error Handling</h4>
<div class="paragraph">
<p>This chapter describes a possible implementation of the CAN error handling within Network FMUs using a rule set based on <code>Bus Error</code> operations.
According to the original CAN error confinement rules, each Network FMU provides its own Transmit Error Counter (TEC), Receive Error Counter (REC) and current CAN node state.
The values for TEC and REC will be increased and decreased with respect to the <code>Error Code</code>, <code>Is Sender</code> and <code>Error Flag</code> arguments of a <code>Bus Error</code> operation.
Based on the values of TEC and REC, the CAN controller moves in the following state machine:</p>
</div>
<div id="figure-can-error-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/can_error_state_machine.svg" alt="can error state machine" width="60%">
</div>
<div class="title">Figure 5. CAN node state machine.</div>
</div>
<div class="paragraph">
<p>This CAN node state machine and the related TEC and REC values have to be implemented in the Network FMUs.
<code>Bus Error</code> operations shall be directly used to maintain the TEC and REC values.
The Network FMU shall react on the <code>Bus Error</code> operations that the Bus Simulation provides, based on the following rule set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When an FMU receives a <code>Bus Error</code> operation where the arguments <code>Is Sender = FALSE</code> and <code>Error Flag = SECONDARY_ERROR_FLAG</code> and also <code>Error Code != BROKEN_ERROR_FRAME</code>, REC shall be increased by 1.</p>
</li>
<li>
<p>When an FMU receives a <code>Bus Error</code> operation where the arguments (<code>Is Sender = FALSE</code> and <code>Error Flag = PRIMARY_ERROR_FLAG</code>) or <code>Error Code = BROKEN_ERROR_FRAME</code>, REC shall be increased by 8.</p>
</li>
<li>
<p>When an FMU receives a <code>Bus Error</code> operation where the arguments <code>Is Sender = TRUE</code> or <code>Error Code = BROKEN_ERROR_FRAME</code>, TEC shall be increased by 8.
Exception: <code>Status =  ERROR_PASSIVE</code> and <code>Error Code = ACK_ERROR</code>.</p>
</li>
<li>
<p>When an FMU provides a <code>Transmit</code> operation and receives a <code>Confirm</code> operation for it, TEC shall be decreased by 1 unless it was already 0.</p>
</li>
<li>
<p>When an FMU receives a <code>Transmit</code> operation, REC shall be decreased by 1, if it was between 1 and 127.
If it was 0, it stays 0.
If REC was greater than 127, it shall be set to any value between 119 and 127.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A Network FMU communicates its current CAN node state via the <code>Status</code> operation by using the following rule set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>After the initialization of a Network FMU, the current CAN node state shall be set to <code>ERROR_ACTIVE</code> and communicated via <code>Status</code> operation to the Bus Simulation.</p>
</li>
<li>
<p>The current CAN node state of a Network FMU shall be set to <code>ERROR_PASSIVE</code> if the value of REC &gt; 127 or TEC &gt; 127 and shall be communicated via <code>Status</code> operation to the Bus Simulation.</p>
</li>
<li>
<p>The current CAN node state of a Network FMU shall be set to <code>ERROR_ACTIVE</code> if the value of REC &lt; 128 and TEC &lt; 128 and shall be communicated via <code>Status</code> operation to the Bus Simulation.</p>
</li>
<li>
<p>The current CAN node state of a Network FMU shall be set to <code>BUS_OFF</code> if the value of TEC &gt; 255 and shall be communicated via <code>Status</code> operation to the Bus Simulation.</p>
</li>
<li>
<p>The <code>BUS_OFF</code> status shall be set back to <code>ERROR_ACTIVE</code> when the Network FMU simulates a controller reset (optional) and has received a total of 128 <code>Transmit</code> or <code>Bus Error</code> operations from the network.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>org.fmi_standard.fmi_ls_bus.Can_BusNotifications</code> is set to <code>false</code>, the <code>Confirm</code> operation cannot be directly used as indicator to set the TEC value and will be incorrect under the rules outlined above.
Also <code>Bus Error</code> operations are not available in this scenario, i.e. the values for TEC and REC remain zero.
In this case, it is recommended to either implement error handling in a different manner or to disable it completely within the specified Network FMU.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="RFC2119"></a>[RFC2119] Bradner, S.: <strong>Key words for use in RFCs to Indicate Requirement Levels</strong>. RFC 2119, March 1997. <a href="https://www.ietf.org/rfc/rfc2119.txt" class="bare">https://www.ietf.org/rfc/rfc2119.txt</a></p>
</li>
<li>
<p><a id="SEMVER200"></a>[SEMVER200] Preston-Werner, T.: <strong>Semantic Versioning 2.0.0</strong>. <a href="https://semver.org/spec/v2.0.0.html" class="bare">https://semver.org/spec/v2.0.0.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>